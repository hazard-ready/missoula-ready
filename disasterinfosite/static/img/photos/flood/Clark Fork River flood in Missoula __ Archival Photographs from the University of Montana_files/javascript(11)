
var SEARCH_RESULTS_STRING="search_results",SEARCH_DROPDOWN_ARROW_HTML_STRING='<span id="search_results_button_arrow" class="icon_10 icon_nav_top_left ui-icon-triangle-1-s"></span>',ALERT_ICON_HTML='<span class="icon_10 ui-icon-alert"></span>',RESULTS_STRING="results",LIST_SEARCH_STRING="list:",CISOSEARCHALL_STRING="CISOSEARCHALL",SELECTED_ELEMENT_STRING="selected='selected'",BEFORE_STRING="before",AFTER_STRING="after",FROM_STRING="from",TO_STRING="to",FIELD_STRING="field";var UTILS_PDF_SEARCH="pdfsearch",UTILS_GET_MORE_FACETS="getmorefacets";var SEARCH_PARAM_SEARCH_TERM="searchterm",SEARCH_PARAM_DISPLAY="display",SEARCH_PARAM_PAGE="page",SEARCH_PARAM_FIELD="field",SEARCH_PARAM_MODE="mode",SEARCH_PARAM_CONNECTOR="conn",SEARCH_PARAM_ORDER="order",SEARCH_PARAM_ASC_DESC="ad";var DOM_ID_SEARCH_RESULTS_BUTTON_MODE="#search_results_button_mode",DOM_ID_SEARCH_RESULTS_DD_LINK="#search_results_dd_link",DOM_ID_SEARCH_CONTENT_BOX="#search_content_box",DOM_ID_SIMPLE_SEARCH_BUTTON="#simple_search_button",DOM_ID_CDM_SEARCH_DEFAULT_MODE="#cdm_searchDefaultMode",DOM_ID_CDM_SEARCH_DEFAULT_CONNECTOR="#cdm_searchDefaultConnector",DOM_ID_CDM_SEARCH_DEFAULT_FIELD="#cdm_searchDefaultField",DOM_ID_CDM_SEARCH_DEFAULT_ORDER="#cdm_searchDefaultOrder",DOM_ID_CDM_SEARCH_COLLECTIONS="#cdm_searchCollections",DOM_ID_CDM_COLLECTIONS_ON="#cdm_collectionsOn",DOM_ID_CDM_COLLECTION="#cdm_collection",DOM_ID_CDM_VIEW="#cdm_view",DOM_ID_CDM_RETURN_VIEW="#cdm_returnview",DOM_ID_CDM_LANGUAGE_ERROR_ENTER_A_WORD_OR_PHRASE="#cdm_language_error_enterAWordOrPhrase",DOM_ID_CDM_LANGUAGE_ERROR_NONE_OPERATOR_MISSING="#cdm_language_error_noneoperatormissing",DOM_ID_CDM_LANGUAGE_SEARCH_THIS_ITEM="#cdm_language_searchthisitem",DOM_ID_CDM_LANGUAGE_TOTAL_INSTANCES_FOUND="#cdm_language_totalinstancesfound",DOM_ID_CDM_LANGUAGE_ONE_INSTANCE_FOUND="#cdm_language_oneinstancefound",DOM_ID_CDM_LANGUAGE_NO_INSTANCES_FOUND="#cdm_language_noinstancesfound",DOM_ID_CDM_SLASH_ENCODE="#cdm_slashencode",DOM_ID_CDM_QUERY_TOTAL="#cdm_query_total",DOM_ID_SEARCH_TERM="#searchterm",DOM_ID_COLLECTION_HOME_URL="#collectionHomeUrl",DOM_ID_SEARCH_QUERY_STRING="searchquery_",DOM_ID_ADVANCED_STRING="advanced_",DOM_ID_ADV_SEARCH_TERM_STRING="_term",DOM_ID_ADV_SEARCH_FIELD_STRING="_field",DOM_ID_ADV_SEARCH_CONNECTOR_STRING="_connector",DOM_ID_ADV_SEARCH_MODE_STRING="_mode",DOM_CLASS_A_DD_OPTION_SEARCH_RESULTS="a.dd_option_searchresults",DOM_CLASS_ADV_SEARCH_ROW_BGCOLOR="adv_search_row_bgcolor",DOM_ELEMENT_ATTRIBUTE_ORDERBY="orderby",DOM_ELEMENT_ATTRIBUTE_COLL="coll",DOM_ELEMENT_ALL_COLLECTIONS_OK_BUTTON="all_collections_ok_button",DOM_ELEMENT_ATTRIBUTE_DIALOG_MODE="dialogMode",SEARCH_RESULTS_BUTTON_MODE_ATTRIBUTE="sbm";var SEARCH_BOX_OFFSET=122,SEARCH_BOX_OFFSET_PDF=107,SEARCH_QUERY_INDEX_FIELD=0,SEARCH_QUERY_INDEX_QUERY=1,SEARCH_QUERY_INDEX_MODE=2,SEARCH_QUERY_INDEX_CONNECTOR=3,FULLTEXT_SEARCH_BOX_CLOSED_FADE_IN=100,FULLTEXT_SEARCH_BOX_CLOSE_ANIMATION_TIME=300,ADVANCED_MAX_COLLECTIONS_DIALOG_WIDTH=490,DATE_SEARCH_LENGTH_YYYYMMDD=8,DATE_SEARCH_LENGTH_YYYYMM=6,SEARCH_WITHIN_RESULTS=1,SEARCH_NEW_SEARCH=0;cdm.gvars.fullTextSearchPrompt="";cdm.gvars.fullTextTotalInstancesFound="";cdm.gvars.fullTextOneInstanceFound="";cdm.gvars.fullTextNoInstancesFound="";cdm.Search=cdm.Search?cdm.Search:{};cdm.Search.cdmView="";cdm.Search.cdmReturnView="";cdm.Search.browseView="search";cdm.Search.newSearch=true;cdm.Search.noSearchTermAlert="";cdm.Search.iisEncodedSlash="%2F";cdm.Search.apacheEncodedSlash="%252F";cdm.Search.facetTerm="";cdm.Search.facetNickname="";cdm.Search.searchTermSetter="searchbox";cdm.Search.searchTermSetterFacet="facet";cdm.Search.searchQueryDelimiterCarot="^";cdm.Search.searchQueryDelimiterExclamation="!";cdm.Search.searchQueryDelimiterDash="-";cdm.Search.searchQueryDelimiterTilde="~";cdm.Search.searchDateDisplayDelimiterSlash="/";cdm.Search.additionalSearchParam="";cdm.Search.newAttribute="";cdm.Search.submitTimeout=100;cdm.Search.fullTextFocusTimeout=350;cdm.Search.homeUrl="";cdm.Search.itemHasFullText=0;cdm.Search.itemDisplayFullText=0;cdm.Search.fullTextSearchModeInit="init";cdm.Search.fullTextSearchModeSearchBox="searchbox";cdm.Search.fullTextSearchTermPrev="";cdm.Search.fullTextFromCompObj=false;cdm.Search.fbCompObj=false;cdm.Search.regexAlphaNum=/^[0-9A-Za-z]+$/;cdm.Search.regexNonWord=/^\W+$/;cdm.Search.regexEncodedSlash=/%2F/g;cdm.Search.advancedSearchRowCount=0;cdm.Search.advancedSearchRowId=0;cdm.Search.advancedSearchAll="";cdm.Search.advancedSearchAny="";cdm.Search.advancedSearchExact="";cdm.Search.advancedSearchNone="";cdm.Search.advancedSearchOr="";cdm.Search.advancedSearchAnd="";cdm.Search.beforeDateDefault="00000000";cdm.Search.afterDateDefault="99999999";cdm.Search.dateSearchOriginal=false;cdm.Search.maxCollectionsMode="";cdm.Search.maxCollectionsAdvancedMode="advanced_";cdm.Search.img_view_search_box_open=false;cdm.Search.search_box_width=0;cdm.Search.fullTextHighlightClass="cdm_full_text_highlight";cdm.Search.fullTextHighlightClassCurrent="cdm_full_text_highlight_current";cdm.Search.fullTextHighlightClassFalse="cdm_full_text_highlight_false";cdm.Search.fullTextPDFHeight=464;cdm.Search.fullTextMatchTotal=0;cdm.Search.fullTextPageTotal=0;cdm.Search.advSearchAddFieldLinkBound=false;cdm.Search.fullTextMatchesCount=0;cdm.Search.dateFieldNickname="date";cdm.Search.advancedFieldsNone=false;cdm.Search.navigateToNextPageHit=false;cdm.Search.fullTextArrowMode="hit";cdm.Search.noneSearchAlert="An additional search operator must be used in conjunction with 'None of these words.'\nPlease refine your search.";cdm.Search.fullTextHiddenString="There is no text for this item.";cdm.Search.slashEncode=ON_STRING;cdm.Search.updatedQuery="";cdm.Search.updatedField="";cdm.Search.updatedMode="";cdm.Search.updatedConnector="";cdm.Search.bracketsReplacementArray=new Array("<",">");cdm.Search.bracketsDecodeArray=new Array(/&lt;/gi,/&gt;/gi);cdm.Search.xssTermsToEncodeArray=new Array(/!/g,/\+/g);cdm.Search.xssReplacementsArray=new Array("","");cdm.Search.postUriEncodings=new Array(/!/g);cdm.Search.postUriReplacements=new Array("%21");cdm.Search.advancedSearchError=false;cdm.Search.init=function(){cdm.Search.searchResultsButtonMode=cdm.Search.setSearchResultsButtonMode($(DOM_ID_SEARCH_RESULTS_BUTTON_MODE).val());cdm.Search.defaultMode=$(DOM_ID_CDM_SEARCH_DEFAULT_MODE).val();cdm.Search.defaultConnector=$(DOM_ID_CDM_SEARCH_DEFAULT_CONNECTOR).val();cdm.Search.defaultField=$(DOM_ID_CDM_SEARCH_DEFAULT_FIELD).val();cdm.Search.defaultOrder=$(DOM_ID_CDM_SEARCH_DEFAULT_ORDER).val();cdm.Search.searchCollections=$(DOM_ID_CDM_SEARCH_COLLECTIONS).val();cdm.gvars.searchCollectionsList=cdm.Search.searchCollections;if($(DOM_ID_SEARCH_RESULTS_DD_LINK).exists()){$(DOM_CLASS_A_DD_OPTION_SEARCH_RESULTS).on({click:function(){cdm.Search.searchResultsButtonMode=$(this).attr(SEARCH_RESULTS_BUTTON_MODE_ATTRIBUTE);$(DOM_ID_SEARCH_RESULTS_BUTTON_MODE).val(cdm.Search.searchResultsButtonMode);$(DOM_ID_SEARCH_RESULTS_DD_LINK).html($("#search_results_button_text_"+cdm.Search.searchResultsButtonMode).val()+SEARCH_DROPDOWN_ARROW_HTML_STRING);$(DOM_ID_SEARCH_RESULTS_DD_LINK).focus();}});create_dropdown(SEARCH_RESULTS_STRING);}
cdm.Search.bindSearchForm();var searchBoxOffset=$(DOM_ID_SEARCH_CONTENT_BOX).offset();cdm.gvars.collectionsOn=parseInt($(DOM_ID_CDM_COLLECTIONS_ON).val());cdm.gvars.activeCollection=$(DOM_ID_CDM_COLLECTION).val();cdm.Search.noSearchTermAlert=$(DOM_ID_CDM_LANGUAGE_ERROR_ENTER_A_WORD_OR_PHRASE).val();cdm.Search.noneSearchAlert=$(DOM_ID_CDM_LANGUAGE_ERROR_NONE_OPERATOR_MISSING).val();}
cdm.Search.queryEncoder=function(term,encodeArray,replacementArray){arrLength=encodeArray.length;for(x=0;x<arrLength;x++){term=term.replace(encodeArray[x],replacementArray[x]);}
return term;}
cdm.Search.encodeSearchTermsForUrl=function(term){term=encodeURIComponent(cdm.Search.queryEncoder(term,cdm.Search.xssTermsToEncodeArray,cdm.Search.xssReplacementsArray));if(cdm.Search.slashEncode===ON_STRING){term=term.replace(cdm.Search.regexEncodedSlash,cdm.Search.apacheEncodedSlash);}
return term;}
cdm.Search.setSearchResultsButtonMode=function(defaultSearchButtoneModeValue){if(defaultSearchButtoneModeValue===RESULTS_STRING){buttonMode=SEARCH_WITHIN_RESULTS;}else{buttonMode=SEARCH_NEW_SEARCH;}
return buttonMode;}
cdm.Search.searchFunctionChooser=function(){if(parseInt(cdm.Search.searchResultsButtonMode,DEFAULT_RADIX_VALUE)===SEARCH_WITHIN_RESULTS){timeoutid=setTimeout("cdm.Search.submitSearchResults()",cdm.Search.submitTimeout);}else{timeoutid=setTimeout("cdm.Search.submitSimpleSearch()",cdm.Search.submitTimeout);}}
cdm.Search.bindSearchForm=function(){$(DOM_ID_SIMPLE_SEARCH_BUTTON).on({click:function(){cdm.Search.searchFunctionChooser();}});$(DOM_ID_SEARCH_CONTENT_BOX).on({keypress:function(event){if(event.keyCode===ENTER_KEY_CODE){cdm.Search.searchFunctionChooser();}}});}
cdm.Search.submitSimpleSearch=function(){simpleSearchParameters=[cdm.Search.homeUrl,cdm.Search.browseView];var searchterm=cdm.Search.encodeSearchTermsForUrl($(DOM_ID_SEARCH_CONTENT_BOX).val());if(searchterm.length===0){alert(cdm.Search.noSearchTermAlert);return false;}else{if(cdm.Search.searchCollections.length>0&&cdm.Search.searchCollections!==ALL_STRING){simpleSearchParameters.push(COLLECTION_STRING,cdm.Search.searchCollections);}
simpleSearchParameters.push(SEARCH_PARAM_SEARCH_TERM,searchterm,SEARCH_PARAM_ORDER,cdm.Search.defaultOrder);cdm.util.pageRedirector(cdm.util.buildUrl(simpleSearchParameters));}}
cdm.Search.buildSearchQueryElements=function(queryElement,queryElementValue,delimiter){queryElement=queryElement+delimiter+queryElementValue;return queryElement;}
cdm.Search.setQueryElementDelimiter=function(query){if(query.length===0){delimiter="";}else{delimiter=cdm.Search.searchQueryDelimiterExclamation;}
return delimiter;}
cdm.Search.setSearchQueryElements=function(delimiter,thisQuery){cdm.Search.updatedQuery=cdm.Search.buildSearchQueryElements(cdm.Search.updatedQuery,thisQuery[SEARCH_QUERY_INDEX_QUERY],delimiter);cdm.Search.updatedField=cdm.Search.buildSearchQueryElements(cdm.Search.updatedField,thisQuery[SEARCH_QUERY_INDEX_FIELD],delimiter);cdm.Search.updatedMode=cdm.Search.buildSearchQueryElements(cdm.Search.updatedMode,thisQuery[SEARCH_QUERY_INDEX_MODE],delimiter);cdm.Search.updatedConnector=cdm.Search.buildSearchQueryElements(cdm.Search.updatedConnector,thisQuery[SEARCH_QUERY_INDEX_CONNECTOR],delimiter);}
cdm.Search.submitSearchResults=function(){var searchterm="";simpleSearchField=cdm.Search.defaultField;if(cdm.Search.searchTermSetter===cdm.Search.searchTermSetterFacet){searchterm=cdm.Search.facetTerm;simpleSearchField=cdm.Search.facetNickname;}else{searchterm=$(DOM_ID_SEARCH_CONTENT_BOX).val();}
if(searchterm.length===0&&cdm.Search.newSearch){alert(cdm.Search.noSearchTermAlert);return false;}
var prevQueryTotal=$(DOM_ID_CDM_QUERY_TOTAL).val();var prev_searchterm=$(DOM_ID_SEARCH_TERM).val();var queryDelimiter="";if((prev_searchterm.length>0)&&(prev_searchterm.substring(0,5)!==LIST_SEARCH_STRING)){for(s=0;s<prevQueryTotal;s++){var termId=DOM_ID_SEARCH_QUERY_STRING+s;var thisQ=$("#"+termId).val().split(cdm.Search.searchQueryDelimiterCarot);if(thisQ[SEARCH_QUERY_INDEX_FIELD]===CISOSEARCHALL_STRING){thisQ[SEARCH_QUERY_INDEX_FIELD]=ALL_STRING;}
if(thisQ[SEARCH_QUERY_INDEX_QUERY].length>0){thisQ[SEARCH_QUERY_INDEX_QUERY]=cdm.Search.encodeSearchTermsForUrl(thisQ[SEARCH_QUERY_INDEX_QUERY]);queryDelimiter=cdm.Search.setQueryElementDelimiter(cdm.Search.updatedQuery);cdm.Search.setSearchQueryElements(queryDelimiter,thisQ);}}}
if(searchterm.length>0){searchterm=cdm.Search.encodeSearchTermsForUrl(searchterm);queryDelimiter=cdm.Search.setQueryElementDelimiter(cdm.Search.updatedQuery);var newTermElements=[simpleSearchField,searchterm,cdm.Search.defaultMode,cdm.Search.defaultConnector];cdm.Search.setSearchQueryElements(queryDelimiter,newTermElements);}
if(cdm.Search.isListSearch(prev_searchterm)){cdm.util.pageRedirector(cdm.Search.buildUrl([cdm.Search.homeUrl,FAVORITES_STRING]));}else{cdm.util.pageRedirector(cdm.Search.buildSearchURL(cdm.Search.updatedQuery,cdm.Search.updatedField,cdm.Search.updatedMode,cdm.Search.updatedConnector));}}
cdm.Search.setAdditionalSearchParameters=function(){var searchParams=new Array();if(cdm.Search.newAttribute!==DOM_ELEMENT_ATTRIBUTE_COLL){if(!cdm.Search.newSearch&&cdm.Search.newAttribute.length>0){if(cdm.Search.newAttribute===SEARCH_PARAM_PAGE){searchParams.push(cdm.Search.newAttribute,$("#cdm_results_page").val());}else{var newSearchAttributeParts=$(cdm.Search.newAttributeItem).attr(cdm.Search.newAttribute).split(URL_DELIMITER);searchParams=searchParams.concat(newSearchAttributeParts);}}
if(cdm.Search.newAttribute!==DOM_ELEMENT_ATTRIBUTE_ORDERBY){var orderby=$("#cdm_results_orderby").val();var ascdesc=$("#cdm_results_ascdesc").val();if(orderby.length===0){orderby=cdm.Search.defaultOrder;}
searchParams.push(SEARCH_PARAM_ORDER,orderby);if(ascdesc.length>0){searchParams.push(SEARCH_PARAM_ASC_DESC,ascdesc);}}}
return searchParams;}
cdm.Search.buildSearchURL=function(updatedQuery,updatedField,updatedMode,updatedConnector){var searchHomeURLParam=cdm.Search.homeUrl;var searchViewParam=($("#cdm_view").val()===FAVORITES_STRING)?FAVORITES_STRING:SEARCH_STRING;var searchUrlParts=[searchHomeURLParam,searchViewParam];var itemThisCollection=$(cdm.Search.newAttributeItem).attr("tc");if(typeof itemThisCollection==='undefined'){itemThisCollection="";}
var additionalSearchParams=cdm.Search.setAdditionalSearchParameters();var searchCollection="";var cdm_collection_val=$("#cdm_collection").val();if(cdm.gvars.collectionsOn===1){if(cdm.gvars.activeCollection===cdm_collection_val){searchCollection=cdm_collection_val;}else if(cdm.gvars.activeCollection.length>0&&cdm.gvars.activeCollection!==cdm_collection_val){searchCollection=cdm.gvars.activeCollection;}}else if(cdm.gvars.collectionsOn>1){if(itemThisCollection.length===0&&$("#cdm_searchCollections").val()!==ALL_STRING){searchCollection=cdm.Search.searchCollections;}else if(cdm.Search.searchCollections!==ALL_STRING){searchCollection=cdm.Search.searchCollections;}}
if(searchCollection.length>0){searchUrlParts.push(COLLECTION_STRING,searchCollection);}
searchUrlParts=cdm.Search.addParamToSearchUrlArray(searchUrlParts,SEARCH_PARAM_SEARCH_TERM,updatedQuery);searchUrlParts=cdm.Search.addParamToSearchUrlArray(searchUrlParts,SEARCH_PARAM_FIELD,updatedField);searchUrlParts=cdm.Search.addParamToSearchUrlArray(searchUrlParts,SEARCH_PARAM_MODE,updatedMode);searchUrlParts=cdm.Search.addParamToSearchUrlArray(searchUrlParts,SEARCH_PARAM_CONNECTOR,updatedConnector);searchUrlParts=searchUrlParts.concat(additionalSearchParams);cdm.Search.newSearch=true;var searchUrl=cdm.util.buildUrl(searchUrlParts);return searchUrl;}
cdm.Search.addParamToSearchUrlArray=function(urlArray,parameterName,parameterValue){if(parameterValue!==undefined&&parameterValue.length>0){urlArray.push(parameterName,parameterValue);}
return urlArray;}
cdm.Search.selectAllMaxCollections=function(s,mode){if(s){$(".results_tn_collection_box_max input").each(function(){$(this).attr('checked',true);$(this).parents(".results_tn_collection_box_max").addClass("results_tn_collection_box_checked");});$("#"+mode+"all_collections_ok_button").removeClass("dialog_button_disabled");if(!cdm.util.hasEvent($("#"+mode+"all_collections_ok_button"),"click")){$("#"+mode+"all_collections_ok_button").click(function(){cdm.Search.setCollectionList(this,mode);});}
if(cdm.Search.collectionTotal>cdm.Search.collectionLimit){$("#"+mode+"collection_limit_information").hide();}}else{$(".results_tn_collection_box_max input").each(function(){$(this).attr('checked',false);$(this).parents(".results_tn_collection_box_max").removeClass("results_tn_collection_box_checked");});cdm.Search.collectionsOn=0;$("#"+mode+"all_collections_ok_button").unbind("click");$("#"+mode+"all_collections_ok_button").addClass("dialog_button_disabled");if(cdm.Search.collectionTotal>cdm.Search.collectionLimit){$("#"+mode+"cdmCollectionsSelected").text(cdm.Search.collectionsOn);$("#"+mode+"collection_limit_information").show();}}}
cdm.Search.collectionLimitCounter=function(item,mode){if($(item).is(':checked')){if(cdm.Search.collectionsOn<cdm.Search.collectionLimit){cdm.Search.collectionsOn++;if(cdm.Search.collectionTotal>cdm.Search.collectionLimit){$("#"+mode+"cdmCollectionsSelected").text(cdm.Search.collectionsOn);}}else{$(item).attr('checked',false);$(item).parents(".results_tn_collection_box_max").toggleClass("results_tn_collection_box_checked");}}else{cdm.Search.collectionsOn--;if(cdm.Search.collectionTotal>cdm.Search.collectionLimit){$("#"+mode+"cdmCollectionsSelected").text(cdm.Search.collectionsOn);}}
if(cdm.Search.collectionsOn>0&&cdm.Search.collectionsOn<cdm.Search.collectionLimit&&$("#"+mode+DOM_ELEMENT_ALL_COLLECTIONS_OK_BUTTON).hasClass("dialog_button_disabled")){$("#"+mode+DOM_ELEMENT_ALL_COLLECTIONS_OK_BUTTON).removeClass("dialog_button_disabled");if(!cdm.util.hasEvent($("#"+mode+DOM_ELEMENT_ALL_COLLECTIONS_OK_BUTTON),"click")){$("#"+mode+DOM_ELEMENT_ALL_COLLECTIONS_OK_BUTTON).click(function(){cdm.Search.setCollectionList(this,mode);});}}
if(cdm.Search.collectionsOn===0){$("#"+mode+DOM_ELEMENT_ALL_COLLECTIONS_OK_BUTTON).unbind("click");$("#"+mode+DOM_ELEMENT_ALL_COLLECTIONS_OK_BUTTON).addClass("dialog_button_disabled");}}
cdm.Search.bindCollectionsDialogs=function(){$(".results_tn_collection_box_max input").on({click:function(){$(this).parents(".results_tn_collection_box_max").toggleClass("results_tn_collection_box_checked");cdm.Search.collectionLimitCounter(this,$(this).attr(DOM_ELEMENT_ATTRIBUTE_DIALOG_MODE));}});$(".results_tn_collection_box_inner2").on({click:function(){$(this).parents(".results_tn_collection_box_max").toggleClass("results_tn_collection_box_checked");collInput=$(this).attr("coll");if($('input[name='+collInput+']').is(':checked')){$('input[name='+collInput+']').attr('checked',false);}else{$('input[name='+collInput+']').attr('checked',true);}
cdm.Search.collectionLimitCounter($('input[name='+collInput+']'),$(this).attr(DOM_ELEMENT_ATTRIBUTE_DIALOG_MODE));}});$(".max_collections_checkbox_select_all").on({click:function(){if($(this).is(':checked')){cdm.Search.selectAllMaxCollections(true,$(this).attr(DOM_ELEMENT_ATTRIBUTE_DIALOG_MODE));}else{cdm.Search.selectAllMaxCollections(false,$(this).attr(DOM_ELEMENT_ATTRIBUTE_DIALOG_MODE));}}});$(".max_collections_link_select_all").on({click:function(){var dm=$(this).attr(DOM_ELEMENT_ATTRIBUTE_DIALOG_MODE);if($("#"+dm+"max_collections_checkbox_select_all").is(':checked')){$("#"+dm+"max_collections_checkbox_select_all").attr('checked',false);cdm.Search.selectAllMaxCollections(false,$(this).attr(DOM_ELEMENT_ATTRIBUTE_DIALOG_MODE));}else{$("#"+dm+"max_collections_checkbox_select_all").attr('checked',true);cdm.Search.selectAllMaxCollections(true,$(this).attr(DOM_ELEMENT_ATTRIBUTE_DIALOG_MODE));}}});}
cdm.Search.initFullTextSearch=function(){cdm.Search.fullTextDisplay=parseInt($("#cdm_fullTextSearchDisplay").val(),DEFAULT_RADIX_VALUE);cdm.Search.fullTextMode=$("#cdm_fullTextSearchMode").val();if(cdm.Search.fullTextMode===""){cdm.Search.fullTextMode=$("#cdm_fullTextSearchModeConfig").val();}
cdm.Search.hasOCR=parseInt($("#cdm_item_hasocr").val(),DEFAULT_RADIX_VALUE);cdm.Search.fullTextMatchesCount=0;cdm.Search.itemType=$("#cdm_item_type").val();cdm.Search.pdfSearch=$("#cdm_pdfsearch").val();if($("#cdm_full_text_search_button").exists()){cdm.Search.bindFullTextSearchAndDisplay();}
if($("#cdm_hasfulltext").exists()){cdm.Search.itemHasFullText=parseInt($("#cdm_hasfulltext").val(),DEFAULT_RADIX_VALUE);cdm.Search.itemDisplayFullText=parseInt($("#cdm_displayfulltext").val(),DEFAULT_RADIX_VALUE);}
if(fullTextSearchTerm.length>0&&cdm.Search.itemHasFullText){cdm.Search.runFullTextSearch(cdm.Search.fullTextSearchModeInit);}
cdm.Search.fullTextSearchTermPrev=fullTextSearchTerm;if(cdm.Search.cdmView===COMPOUND_OBJECT_STRING||cdm.Search.cdmReturnView===COMPOUND_OBJECT_STRING){cdm.Search.fbCompObj=true;cdm.Search.cpditemcount=parseInt($("#cdm_cpd_itemcount").val(),DEFAULT_RADIX_VALUE);cdm.Search.cpdid=parseInt($(SELECTOR_CDM_ID).val(),DEFAULT_RADIX_VALUE);}}
cdm.Search.bindFullTextSearchAndDisplay=function(){cdm.Search.ftSearchBoxClosedWidth=$("#img_view_search_box").width();$("#cdm_full_text_search_button").on({click:function(){cdm.Search.fullTextMode=$("#cdm_fullTextSearchModeConfig").val();cdm.Search.runFullTextSearch(cdm.Search.fullTextSearchModeSearchBox);},keypress:function(event){if(event.keyCode===ENTER_KEY_CODE){cdm.Search.fullTextMode=$("#cdm_fullTextSearchModeConfig").val();cdm.Search.runFullTextSearch(cdm.Search.fullTextSearchModeSearchBox);}}});if($("#img_view_search_box_closed").exists()&&cdm.Search.fullTextDisplay===1){$("#img_view_search_box_closed").on({mouseenter:function(){$(this).parent().addClass("img_view_search_box_hover");$(this).find("span.action_link_10").addClass("img_view_search_box_text_hover");},mouseleave:function(){$(this).parent().removeClass("img_view_search_box_hover");$(this).find("span.action_link_10").removeClass("img_view_search_box_text_hover");}});$("#img_view_search_box_closed").on({click:function(){if(!cdm.Search.img_view_search_box_open){cdm.Search.openFullTextSearch(this);}}});$("#img_view_search_box_closed_link").on({keypress:function(event){if(event.keyCode===ENTER_KEY_CODE&&!cdm.Search.img_view_search_box_open){cdm.Search.openFullTextSearch($("#img_view_search_box_closed"));setTimeout("cdm.Search.setFullTextSearchFocus()",cdm.Search.fullTextFocusTimeout);}}});}
if(cdm.Search.fullTextDisplay===2){cdm.Search.openFullTextSearch($("#img_view_search_box_closed"));}
if($("#img_view_search_text_close_button").exists()){$("#img_view_search_text_close_button").on({click:function(){cdm.Search.closeFullTextSearchBar();},keypress:function(event){if(event.keyCode===ENTER_KEY_CODE){cdm.Search.closeFullTextSearchBar();}},focus:function(){$(this).addClass("dialog_title_bar_close_link_hover");$("span.dialog_title_bar_close_link_itemsearch_inner2").addClass("dialog_title_bar_close_link_inner_hover");},blur:function(){$(this).removeClass("dialog_title_bar_close_link_hover");$("span.dialog_title_bar_close_link_itemsearch_inner2").removeClass("dialog_title_bar_close_link_inner_hover");}});}
if($("#cdm_full_text_search_input").exists()){$("#cdm_full_text_search_input").on({focus:function(){if($(this).val()===cdm.gvars.fullTextSearchPrompt){$(this).attr("value","");}},blur:function(){if($(this).val().length===0){$(this).attr("value",cdm.gvars.fullTextSearchPrompt);}},keypress:function(event){if(event.keyCode===ENTER_KEY_CODE){cdm.Search.runFullTextSearch(cdm.Search.fullTextSearchModeSearchBox);}}});if($("#cdm_full_text_search_input").val()!==cdm.gvars.fullTextSearchPrompt&&$("#img_view_search_box_closed").exists()){cdm.Search.openFullTextSearch($("#img_view_search_box_closed"));}}
cdm.Search.searchSelector="pre";cdm.Search.matchesSelector="pre#full_text_container";cdm.Search.scrollSelector="#img_view_text_content";if($("#findingaid_container").exists()){cdm.Search.searchSelector="#findingaid_container";cdm.Search.matchesSelector=cdm.Search.searchSelector;cdm.Search.scrollSelector=cdm.Search.searchSelector;}
if(cdm.Search.fullTextDisplay>0){$(window).on({resize:function(){if(cdm.Search.img_view_search_box_open){cdm.Search.calc_search_box_width($("div#tabs"));$("#img_view_search_box").width(cdm.Search.search_box_width);}}});}}
cdm.Search.closeFullTextSearchBar=function(){if(cdm.Search.img_view_search_box_open){$("#img_view_search_box_open").hide();$("#img_view_search_box").animate({width:cdm.Search.ftSearchBoxClosedWidth},FULLTEXT_SEARCH_BOX_CLOSE_ANIMATION_TIME,function(){$("#img_view_search_box_closed").fadeIn(FULLTEXT_SEARCH_BOX_CLOSED_FADE_IN);});cdm.Search.img_view_search_box_open=false;}}
cdm.Search.calc_search_box_width=function(end_selector){var boxOffset=$("#cdm_item_type").val()===PDF_STRING?SEARCH_BOX_OFFSET_PDF:SEARCH_BOX_OFFSET;cdm.Search.search_box_width=(end_selector.outerWidth()-boxOffset)+PX_STRING;}
cdm.Search.SuggestedTopicTotals=function(){cdm.Search.SuggestTopicsEnabled=$("#cdm_suggested_topics").val();if($("#cdm_suggestedtopics_counts").val()===ON_STRING&&cdm.Search.SuggestTopicsEnabled===ON_STRING){suggestedTopicsUrlElements=[UTILS_CONTROLLER_STRING,"getsearchtotalrecs"];var coll=$("#cdm_searchCollections").val();if(coll===ALL_STRING){coll="";}
suggestedTopicsUrlElements=cdm.Search.addParamToSearchUrlArray(suggestedTopicsUrlElements,COLLECTION_STRING,coll);$.ajax({type:"GET",url:cdm.util.buildUrl(suggestedTopicsUrlElements),dataType:"json",success:function(msg){if(msg!==null){$.each(msg.recordTotals,function(index,total){if(total.indexOf(cdm.gvars.cdmError)>-1){return false;}
$("#st_"+index).text("("+total+")");});}},error:function(msg){cdm.util.ConsoleLogger(cdm.gvars.cdmError+": "+msg);}});}}
cdm.Search.setCollectionList=function(item,mode){var collectionsChecked="";var oneCollection="";cdm.Search.searchCollections="";var tempCollectionCount=0;cdm.gvars.collectionsOn=0;$("."+mode+"max_collections_checkbox").each(function(){tempCollectionCount++;var thisCollection=$(this).attr("coll");if($(this).is(':checked')){checked=ON_STRING;cdm.gvars.collectionsOn++;oneCollection=thisCollection;cdm.Search.searchCollections=cdm.Search.searchCollections+thisCollection+cdm.Search.searchQueryDelimiterExclamation;}else{checked=OFF_STRING;}
collectionsChecked=collectionsChecked+thisCollection+cdm.Search.searchQueryDelimiterTilde+checked+cdm.Search.searchQueryDelimiterExclamation;});if(tempCollectionCount===cdm.gvars.collectionsOn){cdm.Search.searchCollections=ALL_STRING;}
if(cdm.gvars.collectionsOn===1){cdm.gvars.activeCollection=oneCollection;var getDateNicknameUrlElements=[UTILS_CONTROLLER_STRING,"getfirstdatenickname",COLLECTION_STRING,oneCollection]
$.ajax({type:"GET",url:cdm.util.buildUrl(getDateNicknameUrlElements),dataType:"json",success:function(msg){if(msg.status!==FAILURE_STRING){cdm.Search.dateFieldNickname=msg.field;}
cdm.Search.updateCollectionList(item,mode,collectionsChecked);},error:function(a,b,c){cdm.util.ajaxErrorAlerts("error_therewasanerrorupdatingthecollectionlist",a,b,c);}});$("#cdm_collectionDateField").val(cdm.Search.dateFieldNickname);}else{cdm.Search.updateCollectionList(item,mode,collectionsChecked);}}
cdm.Search.updateCollectionList=function(item,mode,collectionsChecked){if(cdm.Search.searchCollections.substring(cdm.Search.searchCollections.length-1)===cdm.Search.searchQueryDelimiterExclamation){cdm.Search.searchCollections=cdm.Search.searchCollections.substring(0,cdm.Search.searchCollections.length-1);}
$("#cdm_searchCollections").val(cdm.Search.searchCollections);updateCollectionListUrlElements=[UTILS_CONTROLLER_STRING,"updateresultcollections"]
$.ajax({type:"POST",url:cdm.util.buildUrl(updateCollectionListUrlElements),data:"c="+collectionsChecked,dataType:"text",success:function(msg){if(msg===SUCCESS_STRING){$(item).parents("div.ui-dialog-content").dialog("close");if(mode!==DOM_ID_ADVANCED_STRING){cdm.Search.newSearch=false;cdm.Search.newAttribute="";cdm.Search.submitSearchResults();}else{cdm.Search.updateFormCollectionList(collectionsChecked);}}},error:function(a,b,c){cdm.util.ajaxErrorAlerts("error_therewasanerrorupdatingthecollectionlist",a,"","");}});}
cdm.Search.alphaNumericCheck=function(term){return cdm.Search.regexAlphaNum.test(term);}
cdm.Search.simpleSearchUnbinder=function(){$("#simple_search_button").off("click");$("#search_content_box").off("keypress");$("a.dd_option_searchresults").off("click");$("#search_results_dd_link").off("click");}
cdm.Search.updateFormCollectionList=function(colls){$("#advsearchCollectionList").html("");collectionCount=0;collectionCountTotal=0;thelist=colls.split(cdm.Search.searchQueryDelimiterExclamation);for(c=0;c<thelist.length;c++){collectionParts=thelist[c].split(cdm.Search.searchQueryDelimiterTilde);if(collectionParts[1]===ON_STRING){if(collectionCount<cdm.Search.collectionsDisplayLimit){thename=$("input.advanced_max_collections_checkbox[name="+collectionParts[0]+"]").attr("collname");$("#advsearchCollectionList").append("<li>"+thename+"</li>");collectionCount++;}
collectionCountTotal++;}}
cdm.Search.collectionsOn=collectionCountTotal;if(cdm.Search.collectionsOn===cdm.Search.collectionTotal){$("#advsearchCollectionList").html("");$("#advsearchAllMoreText").html($("#cdm_language_allCollections").val());$("#advanced_max_collections_link").text($("#cdm_language_limitsearchtospecificcollections").val());}else{var thelinktext="";if(cdm.Search.collectionsOn>cdm.Search.collectionsDisplayLimit){var collectionNumberOver=cdm.Search.collectionsOn-cdm.Search.collectionsDisplayLimit
thelinktext=$("#cdm_language_plus").val()+" "+collectionNumberOver+" "+$("#cdm_language_more").val();}
$("#advsearchAllMoreText").html(thelinktext);$("#advanced_max_collections_link").text($("#cdm_language_addorremovecollections").val());}}
cdm.Search.advancedFormModeConnector=function(){switch(cdm.Search.defaultMode){case ANY_STRING:cdm.Search.advancedSearchAny=SELECTED_ELEMENT_STRING;break;case EXACT_STRING:cdm.Search.advancedSearchExact=SELECTED_ELEMENT_STRING;break;case NONE_STRING:cdm.Search.advancedSearchNone=SELECTED_ELEMENT_STRING;break;default:cdm.Search.advancedSearchAll=SELECTED_ELEMENT_STRING;break;}
switch(cdm.Search.defaultConnector){case OR_STRING:cdm.Search.advancedSearchOr=SELECTED_ELEMENT_STRING;break;default:cdm.Search.advancedSearchAnd=SELECTED_ELEMENT_STRING;break;}}
cdm.Search.populateAdvancedSearchForm=function(){var queryCount=0;for(a=0;a<cdm.Search.queryTotal;a++){queryId=DOM_ID_SEARCH_QUERY_STRING+a;if($("#"+queryId).exists()){var thisQuery=$("#"+queryId).val().split(cdm.Search.searchQueryDelimiterCarot);isDateSearch=false;if(thisQuery[SEARCH_QUERY_INDEX_FIELD]===cdm.Search.dateFieldNickname){if(!isNaN(thisQuery[SEARCH_QUERY_INDEX_QUERY])){isDateSearch=true;}else{dates=thisQuery[SEARCH_QUERY_INDEX_QUERY].split(cdm.Search.searchQueryDelimiterDash);if(dates.length===2){isDateSearch=(!isNaN(dates[0])&&!isNaN(dates[1])&&(dates[0].length>=4)&&(dates[1].length>=4));}}}
if(isDateSearch){dates=thisQuery[1].split(cdm.Search.searchQueryDelimiterDash);if(dates.length===1){$("#adv_search_date_range").val(ON_STRING);cdm.Search.populateDateField("datepicker1",dates[0]);$("#datepicker2").hide();$("#datepickerTo").hide();}else{if(dates[0]===cdm.Search.beforeDateDefault){$("#adv_search_date_range").val(BEFORE_STRING);cdm.Search.populateDateField("datepicker1",cdm.Search.getOffsetDate(dates[1],"1"));$("#datepicker2").hide();$("#datepickerTo").hide();}else if(dates[1]===cdm.Search.afterDateDefault){$("#adv_search_date_range").val(AFTER_STRING);cdm.Search.populateDateField("datepicker1",cdm.Search.getOffsetDate(dates[0],"-1"));$("#datepicker2").hide();$("#datepickerTo").hide();break;}else{$("#adv_search_date_range").val(FROM_STRING);cdm.Search.populateDateField("datepicker1",dates[0]);cdm.Search.populateDateField("datepicker2",dates[1]);}}
cdm.Search.dateSearchOriginal=true;}else{$("#adv_search_query_builder_list").append(cdm.Search.makeAdvancedSearchRow());if(thisQuery[SEARCH_QUERY_INDEX_FIELD]===CISOSEARCHALL_STRING){thisQuery[SEARCH_QUERY_INDEX_FIELD]=ALL_STRING;}
$("#"+cdm.Search.advancedCurrentRowId+DOM_ID_ADV_SEARCH_MODE_STRING).val(thisQuery[SEARCH_QUERY_INDEX_MODE]);replaceMe=new Array(/%20/gi,/\+/gi,/%27/gi,/%26/gi);replacers=new Array(" "," ","'","&","/");slashReplacerRegEx=/%2F/gi;if(cdm.Search.slashEncode===ON_STRING){slashReplacerRegEx=/%252F/gi;}
replaceMe[replaceMe.length]=slashReplacerRegEx;$("#"+cdm.Search.advancedCurrentRowId+DOM_ID_ADV_SEARCH_TERM_STRING).val(cdm.util.cleanEncodedStringsForDisplay(replaceMe,replacers,thisQuery[SEARCH_QUERY_INDEX_QUERY]));$("#"+cdm.Search.advancedCurrentRowId+DOM_ID_ADV_SEARCH_FIELD_STRING).val(thisQuery[SEARCH_QUERY_INDEX_FIELD]);$("#"+cdm.Search.advancedCurrentRowId+DOM_ID_ADV_SEARCH_CONNECTOR_STRING).val(thisQuery[SEARCH_QUERY_INDEX_CONNECTOR]);queryCount++;}}}
if(queryCount===0){$("#adv_search_query_builder_list").append(cdm.Search.makeAdvancedSearchRow());}}
cdm.Search.makeAdvancedSearchRow=function(){if(cdm.Search.advancedSearchRowCount<cdm.Search.maxFields){var advSearchBGColor="";var advSearchRemoveText="";if(cdm.Search.advancedSearchRowId>0){advSearchBGColor=DOM_CLASS_ADV_SEARCH_ROW_BGCOLOR;advSearchRemoveText=$("#cdm_language_remove").val();}
var row_str="<li id='rid"+cdm.Search.advancedSearchRowId+"' class='adv_search_row "+advSearchBGColor+"'><ul class='adv_search_ul_row'>";row_str=row_str+"<li class='float_left'><label for=\"rid"+cdm.Search.advancedSearchRowId+"_mode\">Advanced search mode:</label><select onmousedown=\"if(cdm.gvars.isInternetExplorer){this.style.position='relative';this.style.width='auto'}\" onchange=\"this.style.position='';this.style.width=''\" onblur=\"this.style.position='';this.style.width=''\" id='rid"+cdm.Search.advancedSearchRowId+"_mode' class='adv_search_type_dd'><option value='all' "+cdm.Search.advancedSearchAll+">"+$("#cdm_language_allofthewords").val()+"</option><option value='any' "+cdm.Search.advancedSearchAny+">"+$("#cdm_language_anyofthewords").val()+"</option><option value='exact' "+cdm.Search.advancedSearchExact+">"+$("#cdm_language_theexactphrase").val()+"</option><option value='none' "+cdm.Search.advancedSearchNone+">"+$("#cdm_language_noneofthewords").val()+"</option></select></li>";row_str=row_str+"<li class='float_left spaceMar5L'><label for=\"rid"+cdm.Search.advancedSearchRowId+"_term\">Advanced search term:</label><input id='rid"+cdm.Search.advancedSearchRowId+"_term' class='adv_search_str' type='text' value=''/></li>";row_str=row_str+"<li class='float_left spaceMar5L spacePad5'>"+$("#cdm_language_in").val()+"</li>";row_str=row_str+"<li class='float_left spaceMar5L'><label for=\"rid"+cdm.Search.advancedSearchRowId+"_field\">Advanced search field:</label><select onmousedown=\"if(cdm.gvars.isInternetExplorer){this.style.position='relative';this.style.width='auto'}\" onchange=\"this.style.position='';this.style.width=''\" onblur=\"this.style.position='';this.style.width=''\" id='rid"+cdm.Search.advancedSearchRowId+"_field' class='adv_search_domain_dd'>";if(cdm.Search.advancedFieldsNone){cdm.Search.advancedFieldsNone=false;cdm.Search.advancedFields=new Array();af=0;for(var index in cdm.gvars.collectionFieldsInfo){cdm.Search.advancedFields[af]=index;af++;}}
for(f=0;f<cdm.Search.advancedFields.length;f++){searchfieldselected="";if(typeof cdm.gvars.collectionFieldsInfo[cdm.Search.advancedFields[f]]!=='undefined'){if($("#cdm_searchDefaultField").val()===cdm.Search.advancedFields[f]){searchfieldselected="selected='selected'";}
row_str=row_str+"<option value='"+cdm.Search.advancedFields[f]+"' "+searchfieldselected+">"+cdm.gvars.collectionFieldsInfo[cdm.Search.advancedFields[f]]+"</option>";}}
row_str=row_str+"</select></li>";row_str=row_str+"<li class='float_left spaceMar5L'><label for=\"rid"+cdm.Search.advancedSearchRowId+"_connector\">Advanced search connector:</label><select id='rid"+cdm.Search.advancedSearchRowId+"_connector' class='adv_search_and_or_dd'><option value='and' "+cdm.Search.advancedSearchAnd+">"+$("#cdm_language_and").val()+"</option><option value='or' "+cdm.Search.advancedSearchOr+">"+$("#cdm_language_or").val()+"</option></select></li>";row_str=row_str+"<li class='adv_search_option_remove_link_box float_left spaceMar10L spacePad5'><a class='remove_adv_search_row_link action_link_10' rid='rid"+cdm.Search.advancedSearchRowId+"' href='javascript://'>"+advSearchRemoveText+"</a></li></ul><span class='clear'></span></li>";cdm.Search.advancedCurrentRowId="rid"+cdm.Search.advancedSearchRowId;cdm.Search.advancedSearchRowCount++;cdm.Search.advancedSearchRowId++;if(cdm.Search.advancedSearchRowCount===cdm.Search.maxFields){cdm.Search.unbindAdvSearchAddFieldLink();}
return row_str;}}
cdm.Search.populateDateField=function(field,datevalue){if(datevalue.length===DATE_SEARCH_LENGTH_YYYYMMDD){$("#"+field).val(datevalue.substr(4,2)+cdm.Search.searchDateDisplayDelimiterSlash+datevalue.substr(6,2)+cdm.Search.searchDateDisplayDelimiterSlash+datevalue.substr(0,4));}else if(datevalue.length===DATE_SEARCH_LENGTH_YYYYMM){$("#"+field).val(datevalue.substr(4,2)+cdm.Search.searchDateDisplayDelimiterSlash+datevalue.substr(0,4));}else{$("#"+field).val(datevalue);}}
cdm.Search.bindAdvSearchAddFieldLink=function(){$("#adv_search_add_field_link").removeClass("adv_search_add_field_link_disabled");cdm.Search.advSearchAddFieldLinkBound=true;$("#adv_search_add_field_link").on({click:function(){$("#adv_search_query_builder_list").append(cdm.Search.makeAdvancedSearchRow());}});}
cdm.Search.unbindAdvSearchAddFieldLink=function(){$("#adv_search_add_field_link").off("click");$("#adv_search_add_field_link").addClass("adv_search_add_field_link_disabled");cdm.Search.advSearchAddFieldLinkBound=false;}
cdm.Search.toggleDateSearchForm=function(){$("#adv_search_by_date_container").slideToggle("normal");if(cdm.Search.dateSearch){cdm.Search.dateSearch=false;$("#icon_adv_search_datearrow").removeClass("ui-icon-triangle-1-s");$("#icon_adv_search_datearrow").addClass("ui-icon-triangle-1-e");}else{cdm.Search.dateSearch=true;$("#icon_adv_search_datearrow").removeClass("ui-icon-triangle-1-e");$("#icon_adv_search_datearrow").addClass("ui-icon-triangle-1-s");}}
cdm.Search.clearAdvancedSearch=function(){if(cdm.Search.advancedSearchRowCount>0){for(a=0;a<=cdm.Search.advancedSearchRowId;a++){$("#rid"+a+"_term").val("");}}
if(cdm.Search.dateSearch){$("#datepicker1").val("");$("#datepicker2").val("");}}
cdm.Search.advancedSearchDelimiter=function(qData){return qData+cdm.Search.searchQueryDelimiterExclamation;}
cdm.Search.addLeadingZeros=function(originalString,numberOfDigits){var formattedString=originalString;for(i=originalString.length;i<numberOfDigits;i++){formattedString="0"+formattedString;}
return formattedString;}
cdm.Search.tryParseDate=function(dateString){var parsedDateString;if(0===dateString.length)
return false;if(cdm.Search.dateFormat===dateString)
return false;if(10<dateString.length)
return dateString;var delimiter;if(-1!==dateString.indexOf(cdm.Search.searchDateDisplayDelimiterSlash))
delimiter=cdm.Search.searchDateDisplayDelimiterSlash;else
delimiter=cdm.Search.searchQueryDelimiterDash;dateParts=dateString.split(delimiter);if(3===dateParts.length){if(4===dateParts[0].length){parsedDateString=dateParts[0]+
cdm.Search.addLeadingZeros(dateParts[1],2)+
cdm.Search.addLeadingZeros(dateParts[2],2);}else{parsedDateString=cdm.Search.addLeadingZeros(dateParts[2],4)+
cdm.Search.addLeadingZeros(dateParts[0],2)+
cdm.Search.addLeadingZeros(dateParts[1],2);}}else if(2===dateParts.length){if(4===dateParts[0].length){parsedDateString=dateParts[0]+cdm.Search.addLeadingZeros(dateParts[1],2);}else{parsedDateString=cdm.Search.addLeadingZeros(dateParts[1],4)+cdm.Search.addLeadingZeros(dateParts[0],2);}}else{parsedDateString=dateString;}
return parsedDateString;}
cdm.Search.getOffsetDate=function(formattedDateString,offset){var dateInt=parseInt(formattedDateString,DEFAULT_RADIX_VALUE);return(dateInt+parseInt(offset))+"";}
cdm.Search.displayAdvancedSearchError=function(field,errorMessage){$("#adv_search_error").html(ALERT_ICON_HTML+" "+$(errorMessage).val());$("#adv_search_error").show();$(field).addClass("ui-datepicker-error-border");$(field).on({focus:function(){$(this).removeClass("ui-datepicker-error-border");}});}
cdm.Search.buildDateSearchParameters=function(){var dateError=false;var dateRange=$("#adv_search_date_range").val();var dateRange1=cdm.Search.tryParseDate($("#datepicker1").val());if(!dateRange1){cdm.Search.displayAdvancedSearchError("#datepicker1","#cdm_language_error_enterADate");dateError=true;}
var dateRange2="";if(!dateError){switch(dateRange){case FROM_STRING:dateRange2=cdm.Search.tryParseDate($("#datepicker2").val());if(!dateRange2){cdm.Search.displayAdvancedSearchError("#datepicker2","#cdm_language_error_enterADate");dateError=true;}
if(dateRange2<dateRange1){cdm.Search.displayAdvancedSearchError("#datepicker2","#cdm_language_error_theseconddatecannotbeearlierthanthefirstdate");dateError=true;}
dateRange2=cdm.Search.searchQueryDelimiterDash+dateRange2;break;case BEFORE_STRING:dateRange2="-"+cdm.Search.getOffsetDate(dateRange1,"-1");dateRange1=cdm.Search.beforeDateDefault;break;case AFTER_STRING:dateRange1=cdm.Search.getOffsetDate(dateRange1,"1");dateRange2="-"+cdm.Search.afterDateDefault;break;case ON_STRING:dateRange2="";break;}}
dateSearchElements=[dateError,dateRange1,dateRange2];return dateSearchElements;}
cdm.Search.buildAdvancedSearchQuery=function(){var advancedSearchRowLength=$(".adv_search_row").length;if(advancedSearchRowLength>0){advancedSearchUrlElements=[CDM_CONTROLLER_STRING,SEARCH_STRING];if(cdm.Search.dateSearch){var dateSearchQuery=cdm.Search.buildDateSearchParameters();if(dateSearchQuery[0]){return false;}else{dateRange1=dateSearchQuery[1];dateRange2=dateSearchQuery[2]}}
advancedSearchRowCounter=0;var advancedSearchTerm="";var theFields="";var theTerms="";var theModes="";var thisMode="";var theConnectors="";var noneCount=0;var lastConnector="";dateFieldDelimiter=cdm.Search.searchQueryDelimiterExclamation;$(".adv_search_row").each(function(){advancedSearchRowCounter++;var myId=$(this).attr("id");advancedSearchTerm=cdm.Search.encodeSearchTermsForUrl($.trim($("#"+myId+DOM_ID_ADV_SEARCH_TERM_STRING).val()));if(advancedSearchTerm.length>0){theTerms=theTerms+advancedSearchTerm;lastConnector=$("#"+myId+DOM_ID_ADV_SEARCH_CONNECTOR_STRING).val();thisMode=$("#"+myId+DOM_ID_ADV_SEARCH_MODE_STRING).val();theFields=theFields+$("#"+myId+DOM_ID_ADV_SEARCH_FIELD_STRING).val();theModes=theModes+thisMode;theConnectors=theConnectors+lastConnector;if(thisMode===NONE_STRING){noneCount++;}
if(advancedSearchRowCounter<advancedSearchRowLength){theFields=cdm.Search.advancedSearchDelimiter(theFields);theTerms=cdm.Search.advancedSearchDelimiter(theTerms);theModes=cdm.Search.advancedSearchDelimiter(theModes);theConnectors=cdm.Search.advancedSearchDelimiter(theConnectors);}}else{if(!cdm.Search.dateSearch){cdm.Search.advancedSearchError=true;cdm.Search.displayAdvancedSearchError("#"+myId+DOM_ID_ADV_SEARCH_TERM_STRING,"#cdm_language_error_enterAWordOrPhrase");}}});if(cdm.Search.advancedSearchError){cdm.Search.advancedSearchError=false;return false;}else if(noneCount===advancedSearchRowLength){alert(cdm.Search.noneSearchAlert);return false;}else{if(cdm.Search.dateSearch){if(theTerms.length===0){dateFieldDelimiter="";}
theFields=theFields+dateFieldDelimiter+cdm.Search.dateFieldNickname;theTerms=theTerms+dateFieldDelimiter+dateRange1+dateRange2;theModes=theModes+dateFieldDelimiter+EXACT_STRING;theConnectors=theConnectors+dateFieldDelimiter+AND_STRING;}
var searchCollections=$("#cdm_searchCollections").val();if(searchCollections.length>0&&searchCollections!==ALL_STRING){advancedSearchUrlElements.push(COLLECTION_STRING,searchCollections);}
advancedSearchUrlElements.push(SEARCH_PARAM_SEARCH_TERM,theTerms,SEARCH_PARAM_FIELD,theFields,SEARCH_PARAM_MODE,theModes,SEARCH_PARAM_CONNECTOR,theConnectors,SEARCH_PARAM_ORDER,cdm.Search.defaultOrder);cdm.util.pageRedirector(cdm.util.buildUrl(advancedSearchUrlElements));}}}
cdm.Search.toggleSimpleSearch=function(){$("#adv_search").slideToggle("normal");$("#search_content_adv_link").text(($("#search_content_adv_link").text()===$("#cdm_language_advancedsearch").val())?$("#cdm_language_closeadvancedsearch").val():$("#cdm_language_advancedsearch").val());if($("#search_content").hasClass("search_content_modal_cover")){cdm.Search.init();$("#search_content").removeClass("search_content_modal_cover");}else{cdm.Search.simpleSearchUnbinder();$("#search_content").addClass("search_content_modal_cover");if(cdm.Search.dateSearchOriginal){cdm.Search.dateSearch=true;$("#adv_search_by_date_container").slideToggle("normal");}}
$("#search_content_close_icon").toggle();}
cdm.Search.isListSearch=function(searchterm){return searchterm.substring(0,5)===LIST_SEARCH_STRING?true:false;}
cdm.Search.initAdvancedSearch=function(){cdm.Search.maxFields=parseInt($("#cdm_advancedSearchMaxFields").val(),DEFAULT_RADIX_VALUE);cdm.Search.advancedSearchFields=$("#cdm_advancedSearchFields").val();cdm.Search.dateFormat=$("#cdm_advancedSearchByDateFormat").val();cdm.Search.datepickerFormat=$("#cdm_advancedSearchDPFormat").val();if(cdm.gvars.collectionsOn===1&&$("#cdm_collectionDateField").val()!==""){cdm.Search.dateFieldNickname=$("#cdm_collectionDateField").val();}
if(cdm.Search.advancedSearchFields===NONE_STRING){cdm.Search.advancedFieldsNone=true;}else{cdm.Search.advancedFields=cdm.Search.advancedSearchFields.split(cdm.Search.searchQueryDelimiterExclamation);}
cdm.Search.advancedFormModeConnector();cdm.Search.dateSearch=false;cdm.Search.collectionLimit=parseInt($("#cdm_collectionSearchLimit").val(),DEFAULT_RADIX_VALUE);cdm.Search.collectionTotal=parseInt($("#cdm_collectionTotal").val(),DEFAULT_RADIX_VALUE);cdm.Search.collectionsOn=parseInt($("#cdm_collectionsOn").val(),DEFAULT_RADIX_VALUE);cdm.Search.collectionsDisplayLimit=parseInt($("#cdm_collectionsDisplayLimit").val(),DEFAULT_RADIX_VALUE);$("#search_content_modal_cover").hide();$("#search_content_adv_link, #search_content_close_icon").on("click","",cdm.Search.toggleSimpleSearch);if(!$("#cdm_query_total").exists()){cdm.Search.queryTotal=0;}else{cdm.Search.queryTotal=parseInt($("#cdm_query_total").val(),DEFAULT_RADIX_VALUE);}
if(cdm.Search.queryTotal>0&&$("#searchterm").val().length>0){cdm.Search.populateAdvancedSearchForm();}else{$("#adv_search_query_builder_list").append(cdm.Search.makeAdvancedSearchRow());}
if(cdm.Search.queryTotal<cdm.Search.maxFields){cdm.Search.bindAdvSearchAddFieldLink();}
$(".remove_adv_search_row_link").live("click",function(){cdm.Search.advancedSearchRowCount--;if($(".adv_search_row").length>1)
$("#"+$(this).attr("rid")).remove();if($(".adv_search_row").length<=1)
$("a.remove_adv_search_row_link").hide();if(!cdm.Search.advSearchAddFieldLinkBound){cdm.Search.bindAdvSearchAddFieldLink();}});$("#adv_search_by_date_container").hide();$("#adv_search_by_date_link").on({click:function(){cdm.Search.toggleDateSearchForm();}});$("#adv_search_date_range").on({change:function(){$("label[for^='datepicker']").remove();switch($(this).val()){case AFTER_STRING:case BEFORE_STRING:case ON_STRING:$("<label for=\"datepicker1\">"+$("#cdm_language_"+$(this).val()).val()+":</label>").insertBefore("#datepicker1");$("#datepicker2").hide();$("#datepickerTo").hide();break;case FROM_STRING:$("<label for=\"datepicker1\">"+$("#cdm_language_from").val()+":</label>").insertBefore("#datepicker1");$("#datepicker2").show();$("#datepickerTo").show();$("<label for=\"datepicker2\">"+$("#cdm_language_to").val()+":</label>").insertBefore("#datepicker2");break;}}});$("#datepicker1, #datepicker2").on({focus:function(){if($(this).val()===cdm.Search.dateFormat){$(this).val("");}
if($(this).hasClass("ui-datepicker-error-border")){$(this).removeClass("ui-datepicker-error-border");}}});$("#advanced_search_button").on({click:function(){timeoutid=setTimeout("cdm.Search.buildAdvancedSearchQuery()",cdm.Search.submitTimeout);}});if($("#advanced_max_collections_link").exists()){$("#advanced_max_collections_link").on({click:function(){dialogOpts.width=ADVANCED_MAX_COLLECTIONS_DIALOG_WIDTH;dialogOpts.height="auto";create_new_dialog("advanced_max_collections",dialogOpts);}});}
$("#advanced_all_collections_ok_button").on({click:function(){cdm.Search.setCollectionList(this,DOM_ID_ADVANCED_STRING);}});$("#advanced_search_clearall").on({click:function(){cdm.Search.clearAdvancedSearch();}});}
cdm.Search.documentReady=function(){cdm.Search.cdmView=$(DOM_ID_CDM_VIEW).val();if(cdm.Search.cdmView===FULL_BROWSER_STRING){cdm.Search.cdmReturnView=$(DOM_ID_CDM_RETURN_VIEW).val();}
cdm.Search.homeUrl=CDM_CONTROLLER_STRING;cdm.Search.slashEncode=$(DOM_ID_CDM_SLASH_ENCODE).val();if($("#simple_search_button").exists()){cdm.Search.init();cdm.Search.initAdvancedSearch();cdm.Search.bindCollectionsDialogs();}
cdm.Search.bindFacetButtons();switch(cdm.Search.cdmView){case FULL_BROWSER_STRING:case COMPOUND_OBJECT_STRING:case SINGLE_ITEM_STRING:cdm.gvars.fullTextSearchPrompt=$(DOM_ID_CDM_LANGUAGE_SEARCH_THIS_ITEM).val();cdm.gvars.fullTextTotalInstancesFound=$(DOM_ID_CDM_LANGUAGE_TOTAL_INSTANCES_FOUND).val();cdm.gvars.fullTextOneInstanceFound=$(DOM_ID_CDM_LANGUAGE_ONE_INSTANCE_FOUND).val();cdm.gvars.fullTextNoInstancesFound=$(DOM_ID_CDM_LANGUAGE_NO_INSTANCES_FOUND).val();cdm.Search.initFullTextSearch();break;}
if($("#idx_links_container").exists()||$("#lp_links_container").exists()){cdm.Search.SuggestedTopicTotals();}}
cdm.Search.bindFacetButtons=function(){$(".get_more_facets").on({click:function(){cdm.Search.getMoreFacets(this);}});}
cdm.Search.getMoreFacets=function(item){itemField=$(item).attr("id").substring($(item).attr("id").indexOf("_")+1);facetPage=$(item).attr("facetPage");getMoreFacetsUrlElements=[UTILS_CONTROLLER_STRING,UTILS_GET_MORE_FACETS,FIELD_STRING,itemField,SEARCH_PARAM_PAGE,facetPage];getMoreFacetsUrl=cdm.util.buildUrl(getMoreFacetsUrlElements);cdm.util.ConsoleLogger("facet url is: "+getMoreFacetsUrl);$(item).hide();$.ajax({type:"GET",url:getMoreFacetsUrl,dataType:"html",success:function(facetData){$("#facet_"+itemField).append(facetData);showMoreButton=parseInt($("#showMoreofTheseFacets").val(),DEFAULT_RADIX_VALUE);$("#showMoreofTheseFacets").remove();if(showMoreButton===1){$(item).show();nextFacetPage=parseInt(facetPage,DEFAULT_RADIX_VALUE)+1;$(item).attr("facetPage",nextFacetPage);}else{$(item).remove();}
cdm.api.Results.bindFacetLinks();},error:function(error){alert(error.responseText);cdm.util.ConsoleLogger(error.responseText);}});}
$(document).ready(function(){cdm.Search.documentReady();});